<ion-view title="Nearby">

  <ion-nav-buttons side="left">
    <button menu-toggle="left" class="button button-icon icon icon-menu"></button>
  </ion-nav-buttons>

  <ion-content class="has-header">
    <!-- <div class="list list-inset">
      <label class="item item-input">
        <i class="icon ion-search placeholder-icon"></i>
        <input type="text" placeholder="Location" ng-disabled="position" ng-model="$parent.location">
      </label>
    </div> -->

    <!-- <div class="item list-inset range">
      <div id="distanceLabel" class="input-label">Distance: {{$parent.distance}} mi</div>
      <i class="icon ion-android-walk"></i>
      <input ng-model="$parent.distance" ng-mouseup="search()" type="range" step="0.25" min="0.25" max="5" name="distance">
      <i class="icon ion-android-car"></i>
    </div> -->

    <div class="list list-inset">
      <div class="item item-input">
        <i class="icon icon-search placeholder-icon"></i>
        <input type="text" placeholder="Search" ng-model="$parent.searchText" ng-model-options="{debounce: 250}">
        <button class="button-icon input-button icon-cross placeholder-icon hover pad-right" ng-if="searchText.length > 0" ng-click="clearSearch()"></button>
      </div>
    </div>

    <div class="list list-inset">
      <label class="item item-input item-select">
        <div class="input-label">
          Category
        </div>
        <select ng-model="selectedCategory" ng-options="category for category in categories | orderBy"></select>
      </label>
    </div>

    <div ng-repeat="event in events | categoryFilter:(selectedCategory) | filter:searchText track by event.id">
      <div class="list card">
        <div class="item item-avatar">
          <img ng-src="{{event.picture}}" src="img/event.png">
          <i ng-class="event.icon"></i>
          <a target="_blank" href="{{event.url}}">
            <span>{{event.name}}</span>
            <i ng-if="!event.isFree" class="icon icon-coin-dollar"></i>
          </a>

          <p>
            <div>
              <span class="icon icon-map2"></span>
              <span ng-if="event.location">
                <a target="_blank" href="https://maps.google.com/?q={{event.location | locationMap}}">
                  {{event.location | location}}
                </a>
              </span>
              <span ng-if="!event.location">
                No location speficied, check the event page
              </span>
            </div>

            {{event.startTime | date:'MMMM d, hh:mm a'}} <span ng-if="event.endTime">- {{event.endTime | date:'MMMM d, hh:mm a'}}</span>
          </p>
        </div>
      
        <div class="item item-body">
          <p>
            <hm-read-more hm-text="{{event.description}}" hm-limit="250" hm-more-text="▼ more" hm-less-text="▲ less"></hm-read-more>
          </p>
          <p class="subdued">
            <span ng-if="event.location.distance">{{event.location.distance | metersToMiles}} miles away</span>
            
            <span ng-if="event.attending">
              <span ng-if="event.location.distance">|</span>
              {{event.attending}} people going
            </span>

            <span ng-if="event.category">
              <span ng-if="event.location.distance || event.attending">|</span>
              {{event.category}}
            </span>
          </p>
        </div>
      
      </div>
    </div>

  </ion-content>
</ion-view>
